<div class="batch">
  <div class="logs">
    <div class="row top_nav_pos navbar bg-body">
      <div class="col-lg-12 col-sm-12 d-inline-flex justify-content-end">

        <div class="small d-inline-flex align-items-center">

          <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [boundaryLinks]="true" [pageSize]="pageSize"
            (pageChange)="refreshLogs()">
            <ng-template ngbPaginationFirst>
              <span class="material-symbols-outlined">
                first_page
              </span>
            </ng-template>
            <ng-template ngbPaginationPrevious>
              <span class="material-symbols-outlined">
                navigate_before
              </span>
            </ng-template>
            <ng-template ngbPaginationPages let-page let-pages="pages">
              @if (pages.length > 0) {
              <li class="ngb-custom-pages-item">
                <div class="d-flex flex-nowrap px-2">
                  <label id="paginationInputLabel" for="paginationInput" class="col-form-label me-2 ms-1">Page</label>
                  <input #i type="text" inputmode="numeric" pattern="[0-9]*" class="form-control custom-pages-input"
                    id="paginationInput" [value]="page" (keyup.enter)="selectPage(i.value)" (blur)="selectPage(i.value)"
                    (input)="formatInput($any($event).target)"
                    aria-labelledby="paginationInputLabel paginationDescription" style="width: 2.5rem"
                    max="collectionSize/pageSize" />
                  <span id="paginationDescription" class="col-form-label text-nowrap px-2"> of {{ pages.length
                    }}</span>
                </div>
              </li>
              }
            </ng-template>
            <ng-template ngbPaginationNext>
              <span class="material-symbols-outlined">
                navigate_next
              </span>
            </ng-template>
            <ng-template ngbPaginationLast>
              <span class="material-symbols-outlined">
                last_page
              </span>
            </ng-template>
          </ngb-pagination>

          <select class="form-select page-size ms-3" [(ngModel)]="pageSize" (ngModelChange)="refreshLogs()">
            <option [ngValue]="5">5</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
            <option [ngValue]="30">30</option>
          </select>

        </div>
      </div>
    </div>

    <div class="row">
      <div class="my-4 py-1"></div>
    </div>

    <div class="row">
      <div class="col-lg-10 col-sm-12">
        <table class="table table-responsive col-12 mt-1">
          <thead>
            <tr class="border-bottom">
              <th scope="col" class="pe-2">Status</th>
              <th scope="col" class="pe-2">Action</th>
              <th scope="col" class="pe-2">Date</th>
              <th scope="col">Details</th>
            </tr>
          </thead>

          <tbody>
            @for (log of inPage; track log.batchLogHeaderId) {
            <tr class="border-bottom">
              @if (log.state === state.RUNNING) {
                <td class="col-2">
                  {{ batchSvc.getProcessLog().state | titlecase }}
                  @if (log.batchLogHeaderId === batchSvc.getProcessLog().batchLogHeaderId) {
                    @if (batchSvc.isProcessRunning()) {
                      {{batchSvc.getProcessLog().percentageOfProcessedItems - calculateProcessedStep(batchSvc.getProcessLog().numberOfItems) }}&percnt;
                    }
                  } @else {
                    <span class="material-symbols-outlined" title="Something gone wrong!">
                      error
                    </span>
                  }                       
                </td>             
              } @else {
                <td class="col-2">
                  {{ log.state | titlecase }}
                </td>
              }
              <td class="col-7">
                {{ log.method | titlecase }}
              </td>
              <td class="col-2">
                {{ log.endDate | date: "dd.MM.yyyy 'at' HH:mm":'':'en-EN'}}
              </td>
              <td class="col-1">
                @if (log.state === state.RUNNING 
                  && log.batchLogHeaderId === batchSvc.getProcessLog().batchLogHeaderId 
                  && batchSvc.isProcessRunning()) {
                  <span class="spinner-border ms-3" aria-hidden="true"></span>
                } @else {
                  <a [routerLink]="['/batch/logs/', log.batchLogHeaderId]"
                  [state]="{ method: log.method, started: log.startDate }">
                  <span class="material-symbols-outlined ms-3">
                    list
                  </span>
                </a>
                } 
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="col-lg-2 d-none d-lg-block">

      </div>
    </div>
  </div>
</div>