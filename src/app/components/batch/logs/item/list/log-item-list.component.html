<div class="batch">
  <div class="logs mt-5">
    <div class="fs-6">

      <div class="row">
        <div class="col-lg-10 col-sm-12 d-flex justify-content-between">

          <div class="col-12 col-xxl-6 small d-flex justify-content-between">
            <button class="btn btn-outline-secondary h-75 d-inline-block" i18n="@@batch.logs.details.fill.all"
              (click)="fillWithAll()">
              Fill batch with all items from the log
            </button>
            @if(failed > 0) {
              <button class="btn btn-outline-secondary h-75 d-inline-block" i18n="@@batch.logs.details.fill.errors"
                (click)="fillWithFailed()">
                Fill batch with errors only
              </button>
            }
          </div>

          <div class="col-12 col-xxl-6 small d-flex justify-content-end">
            <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [boundaryLinks]="true"
              [pageSize]="pageSize" (pageChange)="refreshLogs()">
              <ng-template ngbPaginationFirst>
                <span class="material-symbols-outlined">
                  first_page
                </span>
              </ng-template>
              <ng-template ngbPaginationPrevious>
                <span class="material-symbols-outlined">
                  navigate_before
                </span>
              </ng-template>
              <ng-template ngbPaginationPages let-page let-pages="pages">
                @if (pages.length > 0) {
                <li class="ngb-custom-pages-item">
                  <div class="mb-3 d-flex flex-nowrap px-2">
                    <label id="paginationInputLabel" for="paginationInput" class="col-form-label me-2 ms-1"
                      i18n="@@pagination.page">Page</label>
                    <input #i type="text" inputmode="numeric" pattern="[0-9]*" class="form-control custom-pages-input"
                      id="paginationInput" [value]="page" (keyup.enter)="selectPage(i.value)"
                      (blur)="selectPage(i.value)" (input)="formatInput($any($event).target)"
                      aria-labelledby="paginationInputLabel paginationDescription" style="width: 2.5rem"
                      max="collectionSize/pageSize" />
                    <span id="paginationDescription" class="col-form-label text-nowrap px-2"><span
                        i18n="@@pagination.of"> of </span> {{ pages.length }} </span>
                  </div>
                </li>
                }
              </ng-template>
              <ng-template ngbPaginationNext>
                <span class="material-symbols-outlined">
                  navigate_next
                </span>
              </ng-template>
              <ng-template ngbPaginationLast>
                <span class="material-symbols-outlined">
                  last_page
                </span>
              </ng-template>
            </ngb-pagination>

            <select class="form-select form-select-sm ms-3" [(ngModel)]="pageSize" (ngModelChange)="refreshLogs()">
              <option [ngValue]="5">5</option>
              <option [ngValue]="10">10</option>
              <option [ngValue]="20">20</option>
              <option [ngValue]="30">30</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-10 col-sm-12 d-flex justify-content-between py-4">
          <h4>{{ method }}</h4>
          <div>
            <span i18n="@@batch.logs.started.on">Started on</span><span> {{ started | date: "dd.MM.yyyy 'at'
              HH:mm":'':'en-EN' }}</span>
          </div>
          <div>
            @if(collectionSize > 0) {
            <span>{{ collectionSize }} <span
                i18n="@@batch.logs.details.total">
                total</span>
            </span>
            }
            @if(failed > 0) {
            ,
            <span class="text-danger fw-bold ms-3"> {{ failed }} <span
                i18n="@@batch.logs.details.failed">
                failed</span>
            </span>
            }
          </div>
          <button class="btn pt-0 pe-0" (click)="goBack()" title="Back to Logs">
            <span class="material-symbols-outlined text-secondary fs-2" style="transform: rotate(-180deg);">
              exit_to_app
            </span>
          </button>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-10 col-sm-12">
          <table class="table table-responsive fs-6 col-12" onChange="refreshInPageCount()">
            <thead>
              @if((inPage | stateFilter:refreshFilters():'state').length > 0) {
              <tr class="border-bottom">
                <th scope="col" class="pe-2">Status</th>
                <th scope="col" class="pe-2">Title</th>
                <th scope="col">Message</th>
              </tr>
              }
            </thead>

            <tbody>
              @for (log of inPage | stateFilter:refreshFilters():'state' ; track log.item.itemObjectId) {
              <tr class="border-bottom">
                <td class="col-1">
                  <span>{{ log.item.state | titlecase }}</span>
                </td>
                <td>
                  <span>{{ log.title }}</span>
                </td>
                <td>
                  <span>{{ localeMessages.get(log.item.message) }}</span>
                </td>
              </tr>
              }
              @empty {
              <tr>
                <th colspan="3" class="text-center">
                  <span class="text-center">No items to see</span>
                </th>
              </tr>
              }
            </tbody>
          </table>
        </div>

        <div class="col-lg-2 d-none d-lg-block">
          <form [formGroup]="filterForm">
            @if((collectionSize - failed) > 0) {
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="success" formControlName="success" checked>
              <label class="form-check-label" for="success" i18n="@@batch.logs.details.filter.succeded">
                Show successful items
              </label>
            </div>
            }
            @if(failed > 0) {
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="faile" formControlName="fail" checked>
              <label class="form-check-label" for="fail" i18n="@@batch.logs.details.filter.failed">
                Show failed items
              </label>
            </div>
            }
          </form>
        </div>
      </div>
    </div>
  </div>
</div>