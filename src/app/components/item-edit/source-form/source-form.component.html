@if (genreSpecificResource.hasValue()) {
<div [formGroup]="source_form">
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_basic_source_genre.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
        <div class="col-sm">
            <label for="genre" class="col-sm-2 col-form-label">{{ 'MetadataFields.genre' | translate }}</label>
            <select id="genre" class="form-select" formControlName="genre" (change)="genre_change($event)">
                <option [ngValue]="null" selected>-</option>
                @for (g of genre_types; track g) {
                <option [value]="g">{{'SourceGenre.' + g | translate}}</option>
                }
            </select>
          <!--
            @if(source_form.hasError(error_types.SOURCE_GENRE_NOT_PROVIDED.toString())) {
            <div class="pure-invalid">{{ 'validation.required' | translate}}</div>
            }
            -->
        </div>
        <div class="col-sm-1">
            <pure-add-remove-buttons [index]="index" (notice)="add_remove_source($event)"></pure-add-remove-buttons>
        </div>
    </div>
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_basic_source_title.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
        <div class="col-sm">
            <label for="source_title" class="col-sm-2 col-form-label">{{ 'MetadataFields.title' | translate }}</label>
          @let type =  source_form.get("genre")?.value;
          @if(type === 'JOURNAL') {
            <pure-cone-autosuggest coneType="journals" [form]="$any(source_form.get('title'))" (valueSelected)="journalSelected($event)" [lockIfFilled]="false"></pure-cone-autosuggest>
          }
          @else {
            <input type="text" class="form-control" id="source_title" name="title" formControlName="title">
          }


            <!--
          @if (source_form.get('title')?.hasError('required')) {
            <div class="pure-invalid">{{ 'validation.required' | translate}}</div>
            }
            -->
        </div>
        <div class="col-sm-1"><!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
        </div>
    </div>
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_basic_source_title_alternative.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
        <div class="col-sm">
            <label for="alt_titles" class="col-sm-2 col-form-label">{{ 'MetadataFields.alternativeTitle' | translate }}</label>
            <ng-container formArrayName="alternativeTitles">
                @for (alt of alternativeTitles.controls; track alt; let ati = $index) {
                <ng-container [formGroupName]="ati">
                    <pure-alt-title-form [alt_title_form]="alt" [index]="ati"
                        [index_length]="alternativeTitles.controls.length"
                        (notice)="handleAltTitleNotification($event)"></pure-alt-title-form>
                </ng-container>
                } @empty {
                <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate" [addIconAndText]="true"
                    (notice)="handleAltTitleNotification($event)"></pure-add-remove-buttons>
                }
            </ng-container>
        </div>
        <div class="col-sm-1"><!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
        </div>
    </div>
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_person_organization.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
        <div class="col-sm">
            <label for="creatures" class="col-sm-2 col-form-label">{{ 'MetadataFields.creators' | translate }}</label>
            <ng-container formArrayName="creators">
                <div cdkDropList class="drag-list" (cdkDropListDropped)="dropCreator($event)">
                    @for (creature of creators.controls; track creature; let ci = $index) {
                    <ng-container [formGroupName]="ci">
                        <div class="drag-list-box" cdkDrag>
                            <pure-creator-form [creator_form]="creature" [index]="ci" [index_length]="creators.length" [isSource]="true"
                                (notice)="handleCreatorNotification($event)"></pure-creator-form>
                        </div>
                    </ng-container>
                    } @empty {
                    <div class="col-sm">
                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate" [addIconAndText]="true"
                            (notice)="handleCreatorNotification($event)"></pure-add-remove-buttons>
                    </div>
                    }
                </div>
            </ng-container>
        </div>
        <div class="col-sm-1"><!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
        </div>
    </div>
    <ng-container>
        <div
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.sources_source_publishing_info.display}">
            <pure-publishing-info-form [publishing_info_form]="publishingInfo"></pure-publishing-info-form>
        </div>
    </ng-container>
    <ng-container>
        <div
            class="d-sm-flex flex-sm-row gap-1 mb-1"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.sources_source_identifiers.display}">
            <label class="col-sm-2 col-form-label">{{ 'MetadataFields.identifiers' | translate }}</label>
        </div>
        <div class="d-sm-flex flex-sm-row gap-1 mb-1">
            <div class="col-sm">
                <ng-container formArrayName="identifiers">
                    @for (identifier of identifiers.controls; track identifier; let identifierIndex = $index) {
                    <ng-container [formGroupName]="identifierIndex">
                        <pure-identifier-form [identifier_form]="identifier" [index]="identifierIndex" [multi]="true"
                            [index_length]="identifiers.controls.length"
                            (notice)="handleIdentifierNotification($event)"></pure-identifier-form>
                    </ng-container>
                    }

                    @empty {
                    <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate" [addIconAndText]="true"
                        (notice)="handleIdentifierNotification($event)"></pure-add-remove-buttons>
                    }
                </ng-container>
            </div>
            <div class="col-sm-1"><!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
            </div>
        </div>
    </ng-container>
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages.display ? 'd-sm-flex flex-sm-row gap-1 mb-1 align-items-end' : 'd-none'">
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_volume.display ? 'col-sm-2' : 'd-none'">
            <label for="source_volume" class="col-form-label">{{ 'MetadataFields.volume' | translate }}</label>
            <input type="text" class="form-control" id="source_volume" name="volume" formControlName="volume">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_issue.display ? 'col-sm-2' : 'd-none'">
            <label for="source_issue" class="col-form-label">{{ 'MetadataFields.issue' | translate }}</label>
            <input type="text" class="form-control" id="source_issue" name="issue" formControlName="issue">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_volume.display || genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_issue.display ? 'col-sm-1' : 'd-none'">
            <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
        </div>
    </div>
    <div
        [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages.display ? 'd-sm-flex flex-sm-row gap-1 mb-1 align-items-end' : 'd-none'">
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_start_page.display ? 'col-sm-2' : 'd-none'">
            <label for="source_startPage" class="col-form-label">{{ 'MetadataFields.startPage' | translate }}</label>
            <input type="text" class="form-control" id="source_startPage" name="startPage" formControlName="startPage">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_end_page.display ? 'col-sm-2' : 'd-none'">
            <label for="source_endPage" class="col-form-label">{{ 'MetadataFields.endPage' | translate }}</label>
            <input type="text" class="form-control" id="source_endPage" name="endPage" formControlName="endPage">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_sequence_number_source_sequence_number.display ? 'col-sm-2' : 'd-none'">
            <label for="source_sequenceNumber" class="col-form-label">{{ 'MetadataFields.sequenceNumber' | translate }}</label>
            <input type="text" class="form-control" id="source_sequenceNumber" name="sequenceNumber"
                formControlName="sequenceNumber">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_total_number_of_pages.display ? 'col-sm-2' : 'd-none'">
            <label for="source_totalNumberOfPages" class="col-form-label">{{ 'MetadataFields.totalNumberOfPages' | translate }}</label>
            <input type="text" class="form-control" id="source_totalNumberOfPages" name="totalNumberOfPages"
                formControlName="totalNumberOfPages">
        </div>
        <div
            [ngClass]="genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_start_page.display || genreSpecificResource.value().properties.sources_source_volume_issue_pages_source_end_page.display || genreSpecificResource.value().properties.sources_source_sequence_number_source_sequence_number.display || genreSpecificResource.value().properties.sources_source_total_number_of_pages.display ? 'col-sm-1' : 'd-none'">
            <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
        </div>
    </div>
</div>
} @else if (!genreSpecificResource.hasValue()) {
<pure-loading></pure-loading>
}
