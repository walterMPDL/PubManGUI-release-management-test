<div [formGroup]="creator_form" class="">
    <div class="d-sm-flex flex-sm-row gap-1 mb-1">
        <div class="col-sm ms-sm-3" [ngClass]="{'border-bottom': index !== index_length -1}">

            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-end">
                <div class="col-sm-auto">
                    <span class="material-symbols-outlined">
                        drag_indicator
                    </span>
                </div>
                <div class="col-sm-2">
                    <label for="creator_type" class="col-form-label col-form-label-sm text-end pe-2">type</label>
                    <select id="creator_type" class="form-select form-select-sm" formControlName="type"
                        (change)="type_change(type.value)">
                        <option [value]="null" selected disabled>type</option>
                        @for (t of creator_types; track t) {
                        <option [value]="t">{{t}}</option>
                        }
                    </select>
                </div>
                <div class="col-sm-2">
                    <label for="creator_role" class="col-form-label col-form-label-sm text-end pe-2">role</label>
                    <select id="creator_role" class="form-select form-select-sm" formControlName="role">
                        <option [value]="null" selected disabled>role</option>
                        @for (r of creator_roles; track r) {
                        <option [value]="r">{{r}}</option>
                        }
                    </select>
                </div>
                @if (type.value === 'ORGANIZATION') {
                <div class="col-sm" formGroupName="organization">
                    <label for="name" class="col-form-label col-form-label-sm text-end pe-2">name</label>
                    <pure-selector [form]="organization" [control_name]="'name'" (notice)="updateOU($event)" purePureOus
                        placeholder="search ous ...">
                        <ng-container *pureOption="let item">{{ item.text }}</ng-container>
                    </pure-selector>
                </div>
                <!--TODO link-->
                <a routerLink="/TODO" routerLinkActive="active">
                    <span class="material-symbols-outlined"
                        [ngClass]="{'invisible': !organization.controls.identifier.value}"
                        title="{{organization.controls.identifier.value}}">
                        info
                    </span>
                </a>
                }
                @if (type.value === 'PERSON') {
                <ng-container formGroupName="person">
                    <div class="col-sm-3">
                        <label for="familyName" class="col-form-label col-form-label-sm text-end pe-2">family</label>
                        <!--<input type="text" class="form-control form-control-sm" id="familyName"
                            formControlName="familyName">-->
                        <pure-person-autosuggest [formForPersonsGivenName]="$any(person.controls.givenName)"
                            [formForPersonsFamilyName]="$any(person.controls.familyName)"
                            [formForPersonOrganizations]="$any(person.controls.organizations)"
                            [formForPersonsId]="$any(person.controls.identifier.controls.id)" />
                        <!--
                        <pure-selector [form]="person" [control_name]="'familyName'" (notice)="updatePerson($event)"
                            pureConePersons placeholder="search cone ...">
                            <ng-container *pureOption="let item">{{ item.text }}</ng-container>
                        </pure-selector>
                        -->
                    </div>
                    <div class="col-sm-3">
                        <label for="givenName" class="col-form-label col-form-label-sm text-end pe-2">given</label>
                        <input type="text" class="form-control form-control-sm" id="givenName"
                            formControlName="givenName">
                    </div>
                    @if(person.controls.identifier.controls.type.value == 'CONE') {
                    <div class="col-sm-auto">
                        <span id="coneIcon" class="material-symbols-outlined"
                            title="{{person.controls.identifier.controls.id.value}}">
                            fingerprint
                        </span>
                    </div>
                    }
                    @if(person.controls.orcid.value) {
                    <div class="svg-bg-icon col-sm-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <g id="DOI_logo" transform="translate(-1 -1)">
                                <circle id="Ellipse_3" data-name="Ellipse 3" cx="12" cy="12" r="12"
                                    transform="translate(1 1)" />
                                <path id="Pfad_3497" data-name="Pfad 3497"
                                    d="M15.026,36.471H12.8v-.9a3.833,3.833,0,0,1-.987.7,3.14,3.14,0,0,1-1.465.373,3.237,3.237,0,0,1-2.218-.834A3.716,3.716,0,0,1,7,32.959a3.429,3.429,0,0,1,1.188-2.737,3.52,3.52,0,0,1,2.214-.977,3.635,3.635,0,0,1,1.479.244,3.76,3.76,0,0,1,.924.65V25.374h2.223Zm-2.272-3.5a1.773,1.773,0,0,0-.414-1.221,2.03,2.03,0,0,0-1.261-.562,1.731,1.731,0,0,0-1.209.7,1.791,1.791,0,0,0-.367,1.1,1.715,1.715,0,0,0,.384,1.069,1.38,1.38,0,0,0,1.094.6,1.737,1.737,0,0,0,1.774-1.684Z"
                                    transform="translate(-4.872 -19.803)" fill="#fff" />
                                <path id="Pfad_3498" data-name="Pfad 3498"
                                    d="M62.312,25.618a1.334,1.334,0,1,0,1.332,1.325,1.261,1.261,0,0,0-.389-.936,1.285,1.285,0,0,0-.944-.389Zm-5.852,3.729a3.982,3.982,0,0,0-3.176,1.284,3.617,3.617,0,0,0-.922,2.439,3.78,3.78,0,0,0,.915,2.576,4.421,4.421,0,0,0,6.216,0,3.7,3.7,0,0,0,.915-2.515,3.66,3.66,0,0,0-.922-2.5,3.83,3.83,0,0,0-3.025-1.284Zm4.67.26v7.057h2.362V29.607H61.131ZM56.389,31.5a1.462,1.462,0,0,1,1.1.479,1.588,1.588,0,0,1,.461,1.155A1.637,1.637,0,0,1,57.5,34.3a1.481,1.481,0,0,1-1.109.471,1.459,1.459,0,0,1-1.2-.578,1.687,1.687,0,0,1,0-2.12,1.459,1.459,0,0,1,1.2-.578Z"
                                    transform="translate(-41.732 -20.002)" fill="#fff" />
                            </g>
                        </svg>
                    </div>
                    }
                    <!-- Just in case 
                        <label for="orcid" class="col-sm-1 col-form-label col-form-label-sm text-end pe-2">orcid</label>
                        <div class="col-sm">
                            <input type="text" class="form-control form-control-sm" id="orcid" formControlName="orcid">
                        </div>
                        <label for="id" class="col-sm-1 col-form-label col-form-label-sm text-end pe-2">id</label>
                        <div class="col-sm">
                            <pure-identifier-form [identifier_form]="identifier" [multi]="false"
                                (notice)="handleIdentifierNotification($event)"></pure-identifier-form>
                        </div>
                        -->
                </ng-container>
                }
            </div>

            @if (type.value === 'PERSON') {
            <ng-container formGroupName="person">
                <div formArrayName="organizations">
                    @for (pou of organizations.controls; track pou; let i = $index) {
                    <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center" [formGroupName]="i">
                        <label for="ou_name" class="col-sm-1 col-form-label col-form-label-sm text-end pe-2">ou
                            {{i+1}}</label>
                        <div class="col-sm">
                            <!--
                                <pure-selector [form]="pou" [control_name]="'name'" (notice)="updatePersonOU($event, i)"
                                    purePureOus placeholder="search ous ...">
                                    <ng-container *pureOption="let item">{{ item.text }}</ng-container>
                                </pure-selector>
                            -->
                            <input type="text" class="form-control form-control-sm" id="OuName" formControlName="name">
                            <!--<pre class="col-sm">{{pou.value.name | json}}</pre>-->
                        </div>
                        <!--TODO link-->
                        <a routerLink="/TODO" routerLinkActive="active">
                            <span class="material-symbols-outlined"
                                [ngClass]="{'invisible': !pou.controls.identifier.value}"
                                title="{{pou.controls.identifier.value}}">
                                info
                            </span>
                        </a>
                        <div class="col-sm-1">
                            <pure-add-remove-buttons [index]="i"
                                (notice)="add_remove_person_ou($event)"></pure-add-remove-buttons>
                        </div>
                    </div>
                    } @empty {
                    <div class="col-sm offset-sm-1">
                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'add organization'"
                            (notice)="add_remove_person_ou($event)"></pure-add-remove-buttons>
                    </div>
                    }
                </div>
            </ng-container>
            }
        </div>
        <div class="col-sm-1">
            <pure-add-remove-buttons [index]="index" (notice)="add_remove_creator($event)"></pure-add-remove-buttons>
        </div>
    </div>
</div>