@if (genreSpecificResource.hasValue()) {
<div [formGroup]="meta_form" validationMessagePosition="ignore">
    <div class="accordion" id="accordionPanelsMetadata">
        <!--GROUP Standard-->
        <div class="accordion-item border-0">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button rounded-0" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyStandardGroup" aria-expanded="true"
                    aria-controls="accordionBodyStandardGroup">
                    {{ 'MetadataFields.basicData' | translate}}
                </button>
            </h2>
            <div id="accordionBodyStandardGroup" class="accordion-collapse collapse show">
                <div class="accordion-body mt-3 mb-3">
                    <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                        <label for="genre" class="col-sm-2 col-form-label">{{ 'MetadataFields.genre' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <select id="genre" class="form-select" formControlName="genre"
                                        (change)="changeGenre($event)" data-test="genre">
                                        <option [ngValue]="null" selected disabled>genre</option>
                                        <optgroup label="Top 5">
                                            @for (g of allowed_genre_types; track g) {
                                            @if (genrePriorityList.includes(g)) {
                                            <option [value]="g">{{'MdsPublicationGenre.' + g | translate}}</option>
                                            }}
                                        </optgroup>
                                        <optgroup label="Alphabetically Sorted">
                                            @for (g of allowed_genre_types; track g) {
                                            @if (!genrePriorityList.includes(g)) {
                                            <option [value]="g">{{'MdsPublicationGenre.' + g | translate}}</option>
                                            }}
                                        </optgroup>
                                    </select>
                                  <!--
                                    @if (meta_form.get('genre')?.hasError('required')) {
                                    <div class="pure-invalid">{{ 'validation.required' | translate}}</div>
                                    }
                                    -->
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_item_degree.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label class="col-sm-2 col-form-label">{{ 'MetadataFields.degree' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                                <div class="col-sm">
                                    <input type="text" class="form-control" formControlName="degree" data-test="degree">
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.item_basic_item_title.display ? 'd-sm-flex flex-sm-row gap-1 mb-1 align-items-center' : 'd-none'">
                        <label for="title" class="col-sm-2 col-form-label">{{ 'MetadataFields.title' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <textarea type="text" class="form-control" id="title" name="title"
                                        formControlName="title" data-test="title"></textarea>

                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.item_basic_item_title_alternative.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label for="alt_titles" class="col-sm-2 col-form-label">{{ 'MetadataFields.alternativeTitle' | translate }}</label>
                        <div class="col-sm">
                            <ng-container formArrayName="alternativeTitles">
                                @for (alt of alternativeTitles.controls; track alt; let ati = $index) {
                                <ng-container [formGroupName]="ati">
                                    <pure-alt-title-form [alt_title_form]="alt" [index]="ati"
                                        [index_length]="alternativeTitles.controls.length"
                                        (notice)="handleAltTitleNotification($event)"></pure-alt-title-form>
                                </ng-container>
                                } @empty {
                                <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                                    (notice)="handleAltTitleNotification($event)"></pure-add-remove-buttons>
                                }
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!--GROUP Creator-->
        <div
            [ngClass]="genreSpecificResource.value().properties.creator_person_organization.display ? 'accordion-item border-0' : 'd-none'">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyCreatorGroup" aria-expanded="true"
                    aria-controls="accordionBodyCreatorGroup">
                  {{ 'MetadataFields.personsOrganizations' | translate }}
                </button>
            </h2>
            <div id="accordionBodyCreatorGroup" class="accordion-collapse collapse show">
                <div class="accordion-body mt-3 mb-3">
                    <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                        <label for="creatures" class="col-sm-2 col-form-label">{{ 'MetadataFields.creators' | translate }}</label>
                        <div class="col-sm">
                            <!-- TODO Add many -->
                            <div class="d-sm-flex flex-sm-row gap-1 pt-1 mb-3">
                                <button class="ms-sm-1 btn btn-sm btn-link" type="button"
                                    (click)="openAddMultipleCreatorsModal()" [ngClass]="{'disabled ': loading}">{{
                                    'Edit.addMultipleCreators' | translate
                                  }}
                                    @if(loading)
                                    {
                                    <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                                    <span class="visually-hidden" role="status">Loading...</span>
                                    }
                                </button>
                            </div>
                            <hr />
                          <!--
                            @if(meta_form.errors?.[error_types.ORGANIZATIONAL_METADATA_NOT_PROVIDED]) {
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                                <div class="pure-invalid">{{ 'validation.minOneAffForCreator' | translate }}</div>
                            </div>
                            }
                            -->
                            <ng-container formArrayName="creators" validationMessagePosition="top">
                                <div cdkDropList class="drag-list" (cdkDropListDropped)="dropCreator($event)">
                                    @for (creature of creators.controls; track creature; let ci = $index) {
                                    <ng-container [formGroupName]="ci">
                                        <div cdkDrag>
                                            <pure-creator-form [creator_form]="creature" [index]="ci"
                                                [index_length]="creators.length" [isSource]="false"
                                                (notice)="handleCreatorNotification($event)"></pure-creator-form>
                                        </div>
                                    </ng-container>
                                    } @empty {
                                    <div class="col-sm">
                                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'"
                                            [add_val]="'common.add' | translate" (notice)="handleCreatorNotification($event)"
                                            data-test="add-remove-creators"></pure-add-remove-buttons>
                                    </div>
                                    }
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--GROUP Dates-->
        <div class="accordion-item border-0"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details_item_details_dates.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyDatesGroup" aria-expanded="true"
                    aria-controls="accordionBodyDatesGroup">
                  {{ 'MetadataFields.date' | translate }}
                </button>
            </h2>
            <div id="accordionBodyDatesGroup" class="accordion-collapse collapse show">
                <div class="accordion-body mt-3 mb-3">
                    <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                        <label class="col-sm-2 col-form-label">{{ 'MetadataFields.date' | translate }}</label>
                        <div class="col-sm">

                            @if(meta_form.hasError(error_types.DATE_NOT_PROVIDED.toString())) {
                              <pure-validation-error [validationError]="{'13' : true}"/>
                              <!--
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-end">
                                <div class="pure-invalid" role="alert">{{ 'validation.minOneDate' | translate }}</div>
                            </div>
                            -->
                            }
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-end">
                                <div class="col-sm-2"
                                    [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details_item_details_dates_item_date_issued.display}">
                                    <label class="col-form-label">{{ 'MetadataFields.datePublishedInPrint' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('datePublishedInPrint')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="datePublishedInPrint"
                                        [placeholder]="'common.dateFormat' | translate" validationMessagePosition="top">
                                </div>
                                <div class="col-sm-2"
                                    [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details_item_details_dates_item_published_online.display}">
                                    <label class="col-form-label">{{ 'MetadataFields.datePublishedOnline' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('datePublishedOnline')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="datePublishedOnline"
                                           [placeholder]="'common.dateFormat' | translate" validationMessagePosition="top">
                                </div>
                                <div class="col-sm-2"
                                    [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details_item_details_dates_item_date_accepted.display}">
                                    <label class="col-form-label">{{ 'MetadataFields.dateAccepted' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('dateAccepted')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="dateAccepted"
                                           [placeholder]="'common.dateFormat' | translate" validationMessagePosition="top">
                                </div>
                                <div class="col-sm-2"
                                    [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details_item_details_dates_item_date_submitted.display}">
                                    <label class="col-form-label">{{ 'MetadataFields.dateSubmitted' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('dateSubmitted')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="dateSubmitted"
                                           [placeholder]="'common.dateFormat' | translate" validationMessagePosition="top">
                                </div>
                            </div>
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-start">
                                <div class="col-sm-2">
                                    <label class="col-form-label">{{ 'MetadataFields.dateCreated' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('dateCreated')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="dateCreated"
                                           [placeholder]="'common.dateFormat' | translate" data-test="date-created" validationMessagePosition="top">
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-form-label">{{ 'MetadataFields.dateModified' | translate }}</label>
                                  <!--
                                  @if(meta_form.get('dateModified')?.hasError('pattern')) {
                                    <div class="pure-invalid">{{ 'validation.invalidDateFormat' | translate }}</div>
                                    }
                                    -->
                                    <input type="text" class="form-control" formControlName="dateModified"
                                           [placeholder]="'common.dateFormat' | translate" validationMessagePosition="top">
                                </div>
                            </div>
                            <div class="col-sm-1">
                                <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--GROUP Details-->
        <div class="accordion-item border-0"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.details.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyDetailsGroup" aria-expanded="true"
                    aria-controls="accordionBodyDetailsGroup">
                  {{ 'MetadataFields.details' | translate }}
                </button>
            </h2>
            <div id="accordionBodyDetailsGroup" class="accordion-collapse collapse">
                <div class="accordion-body mt-3 mb-3">
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_item_language.display ? 'd-sm-flex flex-sm-row gap-1 mb-1 align-items-center' : 'd-none'">
                        <label for="languages" class="col-sm-2 col-form-label">{{ 'MetadataFields.languages' | translate }}</label>
                        <div class="col-sm" id="languages">
                            <ng-container formArrayName="languages">
                                @for (language of languages.controls; track languageIndex; let languageIndex = $index) {
                                <ng-container [formGroupName]="languageIndex">
                                    <pure-language-form [language_form]="language" [index]="languageIndex"
                                        [multi]="true" [index_length]="languages.controls.length"
                                        (notice)="handleLanguageNotification($event)"></pure-language-form>
                                </ng-container>
                                }
                                @empty {
                                <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                                    (notice)="handleLanguageNotification($event)"></pure-add-remove-buttons>
                                }
                            </ng-container>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_total_number_of_pages.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label class="col-sm-2 col-form-label">{{ 'MetadataFields.totalNumberOfPages' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <input type="text" class="form-control" formControlName="totalNumberOfPages">
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_review_method.display ? 'd-sm-flex flex-sm-row gap-1 mb-1 align-items-center' : 'd-none'">
                        <label for="reviewMethod" class="col-sm-2 col-form-label">{{ 'MetadataFields.reviewMethod' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <select id="reviewMethod" class="form-select" formControlName="reviewMethod">
                                        <option [ngValue]="null">-</option>
                                        @for (review_method of review_method_types; track review_method) {
                                        <option [value]="review_method">{{'ReviewMethod.' + review_method | translate}}</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_publishing_info.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label for="reviewMethod" class="col-sm-2 col-form-label">{{ 'MetadataFields.publishingInfo' | translate }}</label>
                        <div class="col-sm">
                            <pure-publishing-info-form
                                [publishing_info_form]="publishingInfo"></pure-publishing-info-form>
                        </div>
                    </div>
                    <!--
    <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
        <label for="location" class="col-sm-2 col-form-label">Location</label>
        <div class="col-sm">
            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                <div class="col-sm">
                    <input type="text" class="form-control" id="location" name="location"
                        formControlName="location">
                </div>
                <div class="col-sm-1">
                    <!- -NEEDED to keep the layout including one last collumn for add-remove buttons- ->
                </div>
            </div>
        </div>
    </div>
    -->
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_identifiers.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label class="col-sm-2 col-form-label">{{ 'MetadataFields.identifiers' | translate }}</label>
                        <div class="col-sm">
                            <ng-container formArrayName="identifiers">
                                @for (identifier of identifiers.controls; track identifier; let identifierIndex =
                                $index) {
                                <ng-container [formGroupName]="identifierIndex">
                                    <pure-identifier-form [identifier_form]="identifier" [index]="identifierIndex"
                                        [multi]="true" [index_length]="identifiers.controls.length"
                                        (notice)="handleIdentifierNotification($event)"></pure-identifier-form>
                                </ng-container>
                                }
                                @empty {
                                <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                                    (notice)="handleIdentifierNotification($event)"></pure-add-remove-buttons>
                                }
                            </ng-container>
                        </div>
                    </div>
                </div>
                <div class="d-sm-flex flex-sm-row">
                    <div class="col-sm mx-3">
                        <hr>
                    </div>
                </div>
                <div class="accordion-body mt-3 mb-3">
                    <ng-container formArrayName="abstracts">
                        @for (abstract of abstracts.controls; track abstractIndex; let abstractIndex = $index) {
                        <div
                            [ngClass]="genreSpecificResource.value().properties.content_item_abstract.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                            <label for="abstracts" class="col-sm-2 col-form-label">{{abstractIndex + 1}}.
                              {{ 'MetadataFields.abstract' | translate }}</label>
                            <div class="col-sm" id="abstract">
                                <ng-container [formGroupName]="abstractIndex">
                                    <pure-abstract-form [abstract_form]="abstract" [index]="abstractIndex"
                                        [multi]="true" [index_length]="abstracts.controls.length"
                                        (notice)="handleAbstractNotification($event)"></pure-abstract-form>
                                </ng-container>


                            </div>
                        </div>
                        }
                        @empty {
                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                            (notice)="handleAbstractNotification($event)"></pure-add-remove-buttons>
                        }
                    </ng-container>
                  <hr/>
                    <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                        <label for="freeKeywords" class="col-sm-2 col-form-label">{{ 'MetadataFields.keywords' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <textarea class="form-control" id="freeKeywords" name="freeKeywords"
                                        formControlName="freeKeywords"></textarea>
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.content_item_subject.display && subject_classification_types.length > 0 ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label for="subjects" class="col-sm-2 col-form-label">{{ 'MetadataFields.subjects' | translate }}</label>
                        <div class="col-sm" id="subjects">
                            <ng-container formArrayName="subjects">
                                @for (subject of subjects.controls; track subjectIndex; let subjectIndex = $index) {
                                <ng-container [formGroupName]="subjectIndex">
                                    <pure-subject-form [subject_form]="subject"
                                        [subject_classification_types]="subject_classification_types"
                                        [index]="subjectIndex" [multi]="true" [index_length]="subjects.controls.length"
                                        (notice)="handleSubjectNotification($event)"></pure-subject-form>
                                </ng-container>
                                }
                                @empty {
                                <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                                    (notice)="handleSubjectNotification($event)"></pure-add-remove-buttons>
                                }
                            </ng-container>
                        </div>
                    </div>
                    <div
                        [ngClass]="genreSpecificResource.value().properties.details_item_toc.display ? 'd-sm-flex flex-sm-row gap-1 mb-1' : 'd-none'">
                        <label for="tableOfContents" class="col-sm-2 col-form-label">{{ 'MetadataFields.tableOfContents' | translate }}</label>
                        <div class="col-sm">
                            <div class="d-sm-flex flex-sm-row gap-1 mb-1 align-items-center">
                                <div class="col-sm">
                                    <textarea class="form-control" id="tableOfContents" name="tableOfContents"
                                        formControlName="tableOfContents"></textarea>
                                </div>
                                <div class="col-sm-1">
                                    <!--NEEDED to keep the layout including one last collumn for add-remove buttons-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--GROUP Event-->
        <div class="accordion-item border-0"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.events.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyEventGroup" aria-expanded="true"
                    aria-controls="accordionBodyEventGroup">
                  {{ 'MetadataFields.event' | translate }}
                </button>
            </h2>
            <div id="accordionBodyEventGroup" class="accordion-collapse">
                <div class="accordion-body mt-3 mb-3">
                    <pure-event-form [event_form]="event"></pure-event-form>
                </div>
            </div>
        </div>

        <!--GROUP Project Info-->
        <div class="accordion-item border-0"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.project_info.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyProjectInfoGroup" aria-expanded="true"
                    aria-controls="accordionBodyProjectInfoGroup">
                  {{ 'MetadataFields.projectInfo' | translate }}
                </button>
            </h2>
            <div id="accordionBodyProjectInfoGroup" class="accordion-collapse collapse">

                <ng-container formArrayName="projectInfo">
                    @for (projectInfoElement of projectInfo.controls; track projectInfoElement; let
                    projectInfoIndex =
                    $index) {
                    <div class="accordion-body mt-3 mb-3">
                        <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                            <label for="projectInfos" class="col-sm-2 col-form-label">{{projectInfoIndex + 1}}.
                              {{ 'MetadataFields.projectInfo' | translate }}</label>
                            <div class="col-sm" id="projectInfo">
                                <ng-container [formGroupName]="projectInfoIndex">
                                    <pure-project-info-form [project_info_form]="projectInfoElement"
                                        [index]="projectInfoIndex" [multi]="true"
                                        [index_length]="projectInfo.controls.length"
                                        (notice)="handleProjectInfoNotification($event)"></pure-project-info-form>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                    }
                    @empty {
                    <div class="accordion-body mt-3 mb-3">
                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                            (notice)="handleProjectInfoNotification($event)"></pure-add-remove-buttons>
                    </div>
                    }
                </ng-container>

            </div>
        </div>

        <!--GROUP Legal Case-->
        <div class="accordion-item border-0"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.legal_case.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodyLegalCaseGroup" aria-expanded="true"
                    aria-controls="accordionBodyLegalCaseGroup">
                  {{ 'MetadataFields.legalCase' | translate }}
                </button>
            </h2>
            <div id="accordionBodyLegalCaseGroup" class="accordion-collapse collapse">
                <div class="accordion-body mt-3 mb-3">
                    <pure-legal-case-form [legal_case_form]="legalCase"></pure-legal-case-form>
                </div>
            </div>
        </div>

        <!--GROUP Sources-->
        <div class="accordion-item border-0 mb-3"
            [ngClass]="{'d-none' : !genreSpecificResource.value().properties.sources.display}">
            <h2 class="accordion-header mt-2">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#accordionBodySourcesGroup"
                    [attr.aria-expanded]="!genreSpecificResource.value().properties.sources.optional"
                    aria-controls="accordionBodySourcesGroup"
                    [ngClass]="{'collapsed' : genreSpecificResource.value().properties.sources.optional}">
                  {{ 'MetadataFields.source' | translate }}
                </button>
            </h2>
            <div id="accordionBodySourcesGroup" class="accordion-collapse collapse"
                [ngClass]="{'show' : !genreSpecificResource.value().properties.sources.optional}">
                @if(meta_form.hasError(error_types.SOURCE_NOT_PROVIDED.toString())) {
                <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                    <div class="col-auto">
                        <div class="pure-invalid">Source required for current publication genre</div>
                    </div>
                </div>
                }
                <ng-container formArrayName="sources">
                    @for (source of sources.controls; track source; let sourcesIndex = $index) {
                    <div class="accordion-body mt-3 mb-3">
                        <div class="d-sm-flex flex-sm-row gap-1 mb-1">
                            <label for="sources" class="col-sm-2 col-form-label">{{sourcesIndex + 1}}.
                              {{ 'MetadataFields.source' | translate }}</label>
                            <div class="col-sm">
                                <pure-source-form [source_form]="source" [index]="sourcesIndex"
                                    [index_length]="sources.controls.length"
                                    (notice)="handleSourceNotification($event)"></pure-source-form>
                            </div>
                        </div>
                    </div>
                    } @empty {
                    <div class="accordion-body mt-3 mb-3">
                        <pure-add-remove-buttons [index]="0" [del_val]="'hidden'" [add_val]="'common.add' | translate"
                            (notice)="handleSourceNotification($event)"></pure-add-remove-buttons>
                    </div>
                    }
                </ng-container>
            </div>
        </div>
    </div>
</div>
} @else if (!genreSpecificResource.hasValue()) {
<pure-loading></pure-loading>
}
