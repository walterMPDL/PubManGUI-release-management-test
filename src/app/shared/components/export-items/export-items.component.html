<div class="modal-header">
  <h4 class="modal-title" id="modal-basic-title">
    @if(type === 'exportAll') {
      {{ 'common.searchResult' | translate }}:
    }
    {{ 'common.export' | translate }}
  </h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
</div>

<div class="modal-body">

    <div class="mb-3">
      <label for="formatSelect">Format</label>
      <select class="form-select" [(ngModel)]="selectedExportType" (change)="handleFormatChange($event)" id="formatSelect" name="selectFormat">
        <optgroup label="Format Exports">
        <option [ngValue]="exportTypes.ENDNOTE">
          {{ exportTypes.ENDNOTE }}
        </option>
        <option [ngValue]="exportTypes.BIBTEX">
          {{ exportTypes.BIBTEX }}
        </option>
        <option [ngValue]="exportTypes.JSON">
          {{ exportTypes.JSON }}
        </option>
        <option [ngValue]="exportTypes.ESCIDOC_ITEMLIST_XML">
          {{ exportTypes.ESCIDOC_ITEMLIST_XML }}
        </option>
        <option [ngValue]="exportTypes.MARC_XML">
          {{ exportTypes.MARC_XML }}
        </option>
        </optgroup>
        <optgroup label="Citation Exports">
          <option [ngValue]="exportTypes.PDF">
            {{ exportTypes.PDF }}
          </option>
          <option [ngValue]="exportTypes.DOCX">
            {{ exportTypes.DOCX }}
          </option>
          <option [ngValue]="exportTypes.HTML_PLAIN">
            {{ exportTypes.HTML_PLAIN }}
          </option>
          <option [ngValue]="exportTypes.HTML_LINKED">
            {{ exportTypes.HTML_LINKED }}
          </option>
          <option [ngValue]="exportTypes.JSON_CITATION">
            {{ exportTypes.JSON_CITATION }}
          </option>
          <option [ngValue]="exportTypes.ESCIDOC_SNIPPET">
            {{ exportTypes.ESCIDOC_SNIPPET }}
          </option>

        </optgroup>

      </select>
    </div>

    @if(!isFormat) {
    <div class="mb-3">
      <label for="citationSelect">Citation</label>
      <select class="form-select" [(ngModel)]="selectedCitationType" (change)="handleCitationChange($event)" id="citationSelect" name="selectFormat">

        <option value="{{citationTypes.APA}}">
          {{ citationTypes.APA }}
        </option>
        <option value="{{citationTypes.APA_CJK}}">
          {{ citationTypes.APA_CJK }}
        </option>
        <option value="{{citationTypes.AJP}}">
          {{ citationTypes.AJP }}
        </option>
        <option value="{{citationTypes.JUS}}">
          {{ citationTypes.JUS }}
        </option>
        <option value="{{citationTypes.CSL}}">
          {{ citationTypes.CSL }}
        </option>


      </select>
    </div>


      @if(selectedCitationType===citationTypes.CSL) {
        <div class="mb-3">
          <pure-csl-autosuggest (selectedEvent)="selectCsl($event)" [selectedCslId]="selectedCslId" [selectedCslName]="selectedCslName"/>
        </div>
      }


      <h6>Citation Example</h6>
      <p [innerHTML]="currentCitation"></p>
    }
  @if(type === 'exportAll') {
    <div class="mb-3">
      <label for="sizeInput">Size</label>
      <input class="form-control" id="sizeInput" type="number" [(ngModel)]="selectedSize" (change)="handleSizeChange($event)"/>

      <label for="sizeInput">Offset</label>
      <input class="form-control" id="offsetInput" type="number" [(ngModel)]="selectedFrom" (change)="handleFromChange($event)"/>

    </div>

    <div>
      <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapseSearchQuery'" aria-expanded="true" aria-controls="collapseOne"><i class="bi bi-chevron-down"></i> Show query</button>

      <div id="collapseSearchQuery" class="accordion-collapse collapse bg-light" aria-labelledby="headingOne">
        <textarea class="form-control form-control-sm" [value]="completeQuery | json" rows="25" readonly="true"></textarea>
      </div>
    </div>

  }
</div>

@if(errorMessage) {
  <div class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>
}

<div class="modal-footer">
  @if(!loading) {
    <button type="button" class="btn btn-primary" (click)="download()" [disabled]="!isValid()">Download</button>
  } @else {
    <pure-loading></pure-loading>
  }


  <!--<button type="button" class="btn btn-outline-secondary" (click)="modal.close('Save click')">Download</button>-->
</div>
